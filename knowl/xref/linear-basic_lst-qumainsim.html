<!DOCTYPE html>
<html lang="en-US" dir="ltr">
<!--******************************************-->
<!--*  Authored with PreTeXt                 *-->
<!--*  pretextbook.org                       *-->
<!--*  Theme: default-modern                 *-->
<!--*  Palette:                              *-->
<!--******************************************-->

<!--********************************************-->
<!--*       Generated from PreTeXt source      *-->
<!--*                                          *-->
<!--*         https://pretextbook.org          *-->
<!--*                                          *-->
<!--********************************************-->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="robots" content="noindex, nofollow">
</head>
<body class="ignore-math">
<figure class="listing figure-like"><figcaption><span class="type">Listing</span><span class="space heading-divison-mark heading-divison-mark__space"> </span><span class="codenumber">3.14.4<span class="period heading-divison-mark heading-divison-mark__period">.</span></span><span class="space heading-divison-mark heading-divison-mark__space"> </span>The main simulation function<div class="autopermalink" data-description="Listing 3.14.4: The main simulation function"><a href="#linear-basic_lst-qumainsim" title="Copy heading and permalink for Listing 3.14.4: The main simulation function" aria-label="Copy heading and permalink for Listing 3.14.4: The main simulation function">ðŸ”—</a></div></figcaption><div class="listing__contents"><div class="code-box"><pre class="program clipboardable"><code id="rs-linear-basic_lst-qumainsim-prog" class="language-cpp">void simulation(int numSeconds, int pagesPerMinute) {
    Printer labprinter(pagesPerMinute);

    //The Queue ADT from the standard container library.
    queue&lt;Task&gt; printQueue;

    //A vector of wait-times for each task.
    vector&lt;int&gt; waitingTimes;

    //For every second in the simulation...
    for (int i = 0; i &lt; numSeconds; i++) {

        //If there's a new printing task, add it to the queue.
        if (newPrintTask()) {
            Task task(i);//Create it...
            printQueue.push(task);//Push it.
        }

        //If the printer is not busy and the queue is not empty:
        if (!labprinter.busy() &amp;&amp;!printQueue.empty()) {
            Task nextTask = printQueue.front(); // Assign a new task from the queue.
            printQueue.pop(); // Remove it from the front

            //Add the estimated wait time to our vector.
            waitingTimes.push_back(nextTask.waitTime(i));
            labprinter.startNext(nextTask);
        }

        //Process the current task.
        labprinter.tick();
    }

    //Average out every wait time for the simulation.
    float total=0;
    for (int waitTime : waitingTimes)
        total += waitTime;

    cout &lt;&lt; "Average Wait "&lt;&lt;total/waitingTimes.size()&lt;&lt;" secs "&lt;&lt;printQueue.size()&lt;&lt;" tasks remaining."&lt;&lt;endl;
}
</code></pre></div></div></figure><span class="incontext"><a class="internal" href="linear-basic_simulation-printing-tasks.html#linear-basic_lst-qumainsim">in-context</a></span>
</body>
</html>
